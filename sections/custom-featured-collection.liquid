{%- style -%}
  /* ============================================
     VISIBILITY
     ============================================ */
  .desktop-hero-section {
    display: none;
  }
  .mobile-hero-section {
    display: block;
  }
  @media (min-width: 1024px) {
    .desktop-hero-section {
      display: block;
    }
    .mobile-hero-section {
      display: none;
    }
  }

  /* ============================================
     SCROLLBAR
     ============================================ */
  .products-scroll::-webkit-scrollbar {
    display: none;
  }
  .products-scroll {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  /* ============================================
     INTERACTIVE ELEMENTS
     ============================================ */
  [data-product-link] {
    cursor: pointer !important;
  }

  /* ============================================
     COLOR CONTAINER
     ============================================ */
  .color-container {
    display: flex !important;
    gap: 8px !important;
    visibility: visible !important;
  }

  /* ============================================
     TABLET (767px - 1023px)
     ============================================ */
  @media (min-width: 767px) and (max-width: 1023px) {
    .mobile-hero-section .flex-shrink-0 {
      width: 280px !important;
      height: 400px !important;
      overflow: hidden !important;
    }
    .mobile-hero-section .flex-shrink-0 img {
      width: 280px !important;
      height: 320px !important;
      object-fit: cover !important;
    }
    .mobile-hero-section .flex-shrink-0 > div {
      width: 280px !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    .mobile-hero-section .flex-shrink-0 > div > div:first-child {
      width: 280px !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    .mobile-hero-section .flex {
      gap: 24px !important;
      padding-left: 24px !important;
      padding-right: 24px !important;
    }
    .mobile-hero-section .flex-shrink-0 > div .color-container {
      height: 12px !important;
      min-height: 12px !important;
      width: auto !important;
      flex-wrap: nowrap !important;
      overflow: visible !important;
      display: flex !important;
      align-items: center !important;
      justify-content: flex-start !important;
      gap: 8px !important;
      margin-left: 0 !important;
      margin-right: auto !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    .mobile-hero-section .color-container button {
      flex-shrink: 0 !important;
      width: 12px !important;
      height: 12px !important;
      border-radius: 50% !important;
    }
  }

  /* ============================================
     MOBILE (<767px)
     ============================================ */
  @media (max-width: 766px) {
    .mobile-hero-section .flex-shrink-0 {
      width: 148px !important;
      height: 293px !important;
    }
    .mobile-hero-section .flex-shrink-0 img {
      width: 148px !important;
      height: 200px !important;
    }
    .mobile-hero-section .flex-shrink-0 > div {
      width: 149px !important;
      height: 84px !important;
    }
    .mobile-hero-section .flex-shrink-0 > div > div:first-child {
      width: 149px !important;
    }
  }

  /* ============================================
     WIDE SCREENS (1600px+)
     ============================================ */
  @media (min-width: 1600px) {
    .scroll-button-desktop {
      display: none !important;
    }
  }
{%- endstyle -%}

{%- comment -%}
  ============================================
  VARIABLES
  ============================================
{%- endcomment -%}
{%- assign show_count = section.settings.products_to_show | default: 3 -%}
{%- assign currency_symbol = section.settings.currency_symbol | strip -%}
{%- assign collection_products = section.settings.collection.products -%}
{%- if section.settings.collection != blank and collection_products.size > 0 -%}
  {%- assign has_products = true -%}
{%- else -%}
  {%- assign has_products = false -%}
{%- endif -%}

<section
  class="bg-white"
  id="featured-hero-{{ section.id }}"
  data-money-format="{{ shop.money_format | escape }}"
>
  {%- comment -%}
    ============================================
    DESKTOP LAYOUT (≥1024px)
    ============================================
  {%- endcomment -%}
  <div class="desktop-hero-section w-full h-[864px]">
    <div class="max-w-[1440px] mx-auto h-full">
      <div class="grid grid-cols-12 h-full gap-3">
        <div class="col-span-6 h-full overflow-hidden">
          {% if section.settings.hero_image != blank %}
            <img
              src="{{ section.settings.hero_image | image_url: width: 998 }}"
              alt="{{ section.settings.hero_image.alt | escape }}"
              class="w-full h-full object-cover"
              width="998"
              height="1198"
              loading="lazy"
            >
          {% else %}
            <img
              src="{{ 'featured-collection-hero.png' | asset_url }}"
              alt="Hero"
              class="w-full h-full object-cover"
              width="998"
              height="1198"
              loading="lazy"
            >
          {% endif %}
        </div>

        <div class="col-span-6 bg-white flex flex-col">
          <div class="flex-shrink-0 pt-[96px] pl-[120px]">
            <h2
              class="font-avant font-bold text-black text-[31.25px] leading-[130%] tracking-[0] max-w-[494px] mt-0"
            >
              {{ section.settings.title }}
            </h2>

            <div class="mt-6 max-w-[432px]">
              <p class="font-avenir font-normal text-[#666666] text-[16px] leading-[160%] tracking-[0]">
                {{ section.settings.description }}
              </p>
            </div>

            <div class="mt-14 flex flex-col items-start gap-[10px] w-fit">
              <a
                href="{{ section.settings.link_url }}"
                class="font-avenir font-bold text-black text-[12.8px] leading-[100%] capitalize whitespace-nowrap"
              >
                {{ section.settings.link_text }}
              </a>
              <span
                class="block h-[1px] bg-black w-full"
              ></span>
            </div>
          </div>

          <div class="flex-1 flex items-end pb-[95px]">
            <div
              class="overflow-y-hidden products-scroll w-[720px] h-[363px] overflow-x-auto ml-[120px]"
              id="products-scroll-container-{{ section.id }}"
            >
              <div class="flex w-max gap-8">
                {% if has_products %}
                  {% for product in collection_products limit: show_count %}
                    {% assign initial_variant = product.selected_or_first_available_variant %}
                    {% assign featured_card_image = initial_variant.featured_image | default: product.featured_image %}
                    {% assign color_option_index = null %}
                    {% unless product.has_only_default_variant %}
                      {% for option in product.options_with_values %}
                        {% assign option_name_downcase = option.name | downcase %}
                        {% if option_name_downcase contains 'color'
                          or option_name_downcase contains 'colour'
                          or option_name_downcase contains 'renk'
                        %}
                          {% assign color_option_index = forloop.index0 %}
                          {% break %}
                        {% endif %}
                      {% endfor %}
                      {% if color_option_index == null %}
                        {% assign color_option_index = 0 %}
                      {% endif %}
                    {% endunless %}

                    {% capture product_payload %}
                      {
                        "id": {{ product.id | json }},
                        "title": {{ product.title | json }},
                        "url": {{ product.url | json }},
                        "featured_image": {% if product.featured_image %}{{ product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
                        "variants": [
                          {% for variant in product.variants %}
                            {
                              "id": {{ variant.id | json }},
                              "title": {{ variant.title | json }},
                              "price": {{ variant.price | json }},
                              "compare_at_price": {{ variant.compare_at_price | json }},
                              "available": {{ variant.available | json }},
                              "image": {% if variant.featured_image %}{{ variant.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
                              "options": {{ variant.options | json }}
                            }{% unless forloop.last %},{% endunless %}
                          {% endfor %}
                        ],
                        "color_option_index": {{ color_option_index | json }}
                      }
                    {% endcapture %}
                    <div
                      class="flex-shrink-0 product-card w-[230px]"
                      data-product-card
                      data-product-json="{{ product_payload | strip_newlines | escape }}"
                      data-initial-variant-id="{{ initial_variant.id }}"
                      {% if color_option_index != null %}
                        data-color-option-index="{{ color_option_index }}"
                      {% endif %}
                    >
                      {% if featured_card_image %}
                        <img
                          src="{{ featured_card_image | image_url: width: 400 }}"
                          alt="{{ initial_variant.title | default: product.title | escape }}"
                          class="object-cover w-[230px] h-[310px]"
                          width="400"
                          height="537"
                          loading="lazy"
                          data-product-image
                        >
                      {% else %}
                        <img
                          src="{{ 'bg-1.png' | asset_url }}"
                          alt="{{ product.title | escape }}"
                          class="object-cover w-[230px] h-[310px]"
                          width="400"
                          height="537"
                          loading="lazy"
                          data-product-image
                        >
                      {% endif %}

                      <div class="mt-[12px] h-[70px]">
                        <a
                          href="{{ product.url | append: '?variant=' | append: initial_variant.id }}"
                          data-product-link
                        >
                          <p class="font-avenir text-black line-clamp-1 text-[12.8px] leading-[160%]">
                            {{ product.title }}
                          </p>
                        </a>
                        <div class="flex justify-between items-center mt-1">
                          <p
                            class="font-avenir font-bold text-black text-[12.8px] min-w-[68px]"
                            data-product-price
                            {% if currency_symbol != blank %}
                              data-currency-symbol="{{ currency_symbol }}"
                            {% endif %}
                          >
                            {% if currency_symbol != blank %}
                              {{ currency_symbol -}}
                              {{- initial_variant.price | money_without_currency }}
                            {% else %}
                              {{ initial_variant.price | money }}
                            {% endif %}
                          </p>
                          {% if product.has_only_default_variant %}
                            <div class="color-container" data-variant-pills></div>
                          {% else %}
                            <div class="color-container" data-variant-pills>
                              {% assign rendered_colors = '' %}
                              {% for variant in product.variants %}
                                {% if color_option_index == 0 %}
                                  {% assign color_value = variant.option1 %}
                                {% elsif color_option_index == 1 %}
                                  {% assign color_value = variant.option2 %}
                                {% elsif color_option_index == 2 %}
                                  {% assign color_value = variant.option3 %}
                                {% else %}
                                  {% assign color_value = variant.option1 %}
                                {% endif %}
                                {% if color_value != blank %}
                                  {% assign color_token = '|' | append: color_value | append: '|' %}
                                  {% unless rendered_colors contains color_token %}
                                    <button
                                      type="button"
                                      class="rounded-full border cursor-pointer w-[12px] h-[12px]{% if variant.id == initial_variant.id %} border-black{% else %} border-gray-300{% endif %}"
                                      data-variant-id="{{ variant.id }}"
                                      data-variant-color="{{ color_value | escape }}"
                                      aria-label="{{ color_value | escape }}"
                                      style="background-color: {{ color_value | handle | replace: '-', '' }};{% if variant.id == initial_variant.id %} box-shadow: inset 0 0 0 1px #FFFFFF;{% endif %}"
                                    ></button>
                                    {% assign rendered_colors = rendered_colors | append: color_token %}
                                  {% endunless %}
                                {% endif %}
                              {% endfor %}
                            </div>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                {% endif %}
              </div>
            </div>
          </div>

          <button
            class="scroll-button-desktop absolute scroll-button-left"
            style="width: 40px; height: 40px; top: 541px; right: 210px; border: 1px solid #0000001A; background: transparent; padding: 12px; cursor: pointer; display: none;"
            onclick="scrollProducts(this);"
            data-direction="left"
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M11 12.5L4.5 8L11 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button
            class="scroll-button-desktop absolute scroll-button-right"
            style="width: 40px; height: 40px; top: 541px; right: 70px; border: 1px solid #0000001A; background: transparent; padding: 12px; cursor: pointer;"
            onclick="scrollProducts(this);"
            data-direction="right"
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M5 12.5L11.5 8L5 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  {%- comment -%}
    ============================================
    MOBILE LAYOUT (<1024px)
    ============================================
  {%- endcomment -%}
  <div class="mobile-hero-section relative">
    <div class="relative h-[437px]">
      {% if section.settings.hero_image != blank %}
        <img
          src="{{ section.settings.hero_image | image_url: width: 720 }}"
          alt="{{ section.settings.hero_image.alt | escape }}"
          class="w-full h-full object-cover"
          width="360"
          height="437"
          loading="lazy"
        >
      {% else %}
        <img
          src="{{ 'featured-collection-hero.png' | asset_url }}"
          alt="Hero"
          class="w-full h-full object-cover"
          width="360"
          height="437"
          loading="lazy"
        >
      {% endif %}

      <div
        class="absolute inset-0 z-10"
        style="background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, #000000 78.65%) !important; opacity: 0.9 !important;"
      ></div>

      <div class="absolute z-20 top-[248px] left-6 w-[312px]">
        <h2
          class="font-avant font-bold text-white mb-4 w-[312px] h-[78px] text-[20px] leading-[130%]"
        >
          {{ section.settings.title }}
        </h2>

        <div class="mt-6 w-fit">
          <a
            href="{{ section.settings.link_url }}"
            class="text-white font-avenir font-bold text-[12.8px] leading-[100%] capitalize block whitespace-nowrap"
          >
            {{ section.settings.link_text }}
          </a>
          <span
            class="block mt-[6px] h-[2px] bg-white w-full"
          ></span>
        </div>
      </div>
    </div>

    <div
      class="absolute z-30 top-[397px] left-0 right-0 w-full h-[293px]"
    >
      <div>
        <div
          class="flex overflow-x-auto products-scroll pb-8 gap-4 pl-6 pr-6"
          style="scroll-behavior: smooth;"
        >
          {% if has_products %}
            {% for product in collection_products limit: show_count %}
              {% assign initial_variant = product.selected_or_first_available_variant %}
              {% assign featured_card_image = initial_variant.featured_image | default: product.featured_image %}
              {% assign color_option_index = null %}
              {% unless product.has_only_default_variant %}
                {% for option in product.options_with_values %}
                  {% assign option_name_downcase = option.name | downcase %}
                  {% if option_name_downcase contains 'color'
                    or option_name_downcase contains 'colour'
                    or option_name_downcase contains 'renk'
                  %}
                    {% assign color_option_index = forloop.index0 %}
                    {% break %}
                  {% endif %}
                {% endfor %}
                {% if color_option_index == null %}
                  {% assign color_option_index = 0 %}
                {% endif %}
              {% endunless %}
              {% capture product_payload %}
                {
                  "id": {{ product.id | json }},
                  "title": {{ product.title | json }},
                  "url": {{ product.url | json }},
                  "featured_image": {% if product.featured_image %}{{ product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
                  "variants": [
                    {% for variant in product.variants %}
                      {
                        "id": {{ variant.id | json }},
                        "title": {{ variant.title | json }},
                        "price": {{ variant.price | json }},
                        "compare_at_price": {{ variant.compare_at_price | json }},
                        "available": {{ variant.available | json }},
                        "image": {% if variant.featured_image %}{{ variant.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
                        "options": {{ variant.options | json }}
                      }{% unless forloop.last %},{% endunless %}
                    {% endfor %}
                  ],
                  "color_option_index": {{ color_option_index | json }}
                }
              {% endcapture %}
              <div
                class="flex-shrink-0 product-card"
                data-product-card
                data-initial-variant-id="{{ initial_variant.id }}"
                {% if color_option_index != null %}
                  data-color-option-index="{{ color_option_index }}"
                {% endif %}
                data-product-json="{{ product_payload | strip_newlines | escape }}"
              >
                {% if featured_card_image %}
                  <img
                    src="{{ featured_card_image | image_url: width: 300 }}"
                    alt="{{ initial_variant.title | default: product.title | escape }}"
                    class="object-cover"
                    width="300"
                    height="405"
                    loading="lazy"
                    data-product-image
                  >
                {% else %}
                  <img
                    src="{{ 'bg-' | append: forloop.index | append: '.png' | asset_url }}"
                    alt="{{ product.title | escape }}"
                    class="object-cover"
                    width="300"
                    height="405"
                    loading="lazy"
                    data-product-image
                  >
                {% endif %}

                <div class="mt-2">
                  <div class="w-[149px] mb-2">
                    <a href="{{ product.url | append: '?variant=' | append: initial_variant.id }}" data-product-link>
                      <p
                        class="font-avenir text-black text-[12.8px] leading-[160%] m-0 p-0"
                      >
                        {{ product.title }}
                      </p>
                    </a>
                    <p
                      class="font-avenir font-bold text-black text-[12.8px] m-0 p-0"
                      data-product-price
                      {% if currency_symbol != blank %}
                        data-currency-symbol="{{ currency_symbol }}"
                      {% endif %}
                    >
                      {% if currency_symbol != blank %}
                        {{ currency_symbol -}}
                        {{- initial_variant.price | money_without_currency }}
                      {% else %}
                        {{ initial_variant.price | money }}
                      {% endif %}
                    </p>
                  </div>

                  {% if product.has_only_default_variant %}
                    <div
                      class="color-container w-[66px] h-3"
                      data-variant-pills
                    ></div>
                  {% else %}
                    <div
                      class="color-container w-[66px] h-3 flex gap-2 visible mt-2"
                      data-variant-pills
                    >
                      {% assign rendered_colors = '' %}
                      {% for variant in product.variants %}
                        {% if color_option_index == 0 %}
                          {% assign color_value = variant.option1 %}
                        {% elsif color_option_index == 1 %}
                          {% assign color_value = variant.option2 %}
                        {% elsif color_option_index == 2 %}
                          {% assign color_value = variant.option3 %}
                        {% else %}
                          {% assign color_value = variant.option1 %}
                        {% endif %}
                        {% if color_value != blank %}
                          {% assign color_token = '|' | append: color_value | append: '|' %}
                          {% unless rendered_colors contains color_token %}
                            <button
                              type="button"
                              class="rounded-full border cursor-pointer w-[12px] h-[12px]{% if variant.id == initial_variant.id %} border-black{% else %} border-gray-300{% endif %}"
                              data-variant-id="{{ variant.id }}"
                              data-variant-color="{{ color_value | escape }}"
                              aria-label="{{ color_value | escape }}"
                              style="background-color: {{ color_value | handle | replace: '-', '' }};{% if variant.id == initial_variant.id %} box-shadow: inset 0 0 0 1px #FFFFFF;{% endif %}"
                            ></button>
                            {% assign rendered_colors = rendered_colors | append: color_token %}
                          {% endunless %}
                        {% endif %}
                      {% endfor %}
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>

      <button
        class="scroll-button-mobile-tablet absolute scroll-button-left"
        style="width: 32px; height: 32px; top: 40%; right: 12px; transform: translateY(-50%); border: 1px solid rgba(0,0,0,0.1); background: transparent !important; padding: 8px; cursor: pointer; display: none; z-index: 10;"
        onclick="scrollProductsMobile(this);"
        data-direction="left"
      >
        <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
          <path d="M11 12.5L4.5 8L11 3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button
        class="scroll-button-mobile-tablet absolute scroll-button-right"
        style="width: 32px; height: 32px; top: 40%; right: 75px; transform: translateY(-50%); border: 1px solid rgba(0,0,0,0.1); background: transparent !important; padding: 8px; cursor: pointer; z-index: 10;"
        onclick="scrollProductsMobile(this);"
        data-direction="right"
      >
        <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
          <path d="M5 12.5L11.5 8L5 3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="h-[293px]"></div>
  </div>
</section>

<script src="{{ 'featured-collection.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Featured Hero Collection",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "hero_image",
      "label": "Hero Image"
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Link Text"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL"
    },
    {
      "type": "text",
      "id": "currency_symbol",
      "label": "Currency Symbol",
      "default": "€"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 1,
      "max": 25,
      "step": 1,
      "default": 3,
      "label": "Products to show"
    }
  ],
  "presets": [
    {
      "name": "Featured Hero Collection"
    }
  ]
}
{% endschema %}
